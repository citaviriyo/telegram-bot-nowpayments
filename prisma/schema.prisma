generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Member {
  id         String   @id @default(cuid())
  telegramId String   @unique
  status     String   @default("ACTIVE")
  expiredAt  DateTime
  inviteLink String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  subscriptions Subscription[]
}

model Subscription {
  id            String    @id @default(cuid())
  memberId      String
  plan          String
  startsAt      DateTime  @default(now())
  endsAt        DateTime
  status        String    @default("active")
  warn3SentAt   DateTime?
  warn1SentAt   DateTime?
  kickedAt      DateTime?
  lastCheckedAt DateTime?
  member        Member    @relation(fields: [memberId], references: [id])

  @@index([endsAt])
  @@index([status])
}

model Payment {
  id           String    @id @default(cuid())
  paymentId    String    @unique
  status       String
  raw          Json?
  inviteSentAt DateTime?  // âœ… lock: supaya invite cuma terkirim 1x
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

