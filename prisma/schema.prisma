generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // pooler (runtime)
  directUrl = env("DIRECT_URL")     // non-pool (migration)
}

model Member {
  id        String   @id @default(cuid())
  tgUserId  BigInt   @unique
  username  String?
  createdAt DateTime @default(now())

  subscriptions Subscription[]
}

model Subscription {
  id        String   @id @default(cuid())
  memberId  String
  plan      String
  startsAt  DateTime @default(now())
  endsAt    DateTime
  status    String   @default("active") // active | expired | canceled
  warn3SentAt DateTime?
  warn1SentAt DateTime?

  member    Member   @relation(fields: [memberId], references: [id])

  @@index([endsAt])
  @@index([status])
}
